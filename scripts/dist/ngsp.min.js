var ngsp;!function(t){angular.module("ngsp",[])}(ngsp||(ngsp={}));var ngsp;!function(t){var e;!function(e){var n=function(){function e(n,r,i){var a=this;this.queryparams="",this.queryheaders={headers:{accept:"application/json;odata=verbose"}},this._utils=new t.utilities.utils,this.bytitle=function(t){return new e(a.servicepoint,"/getbytitle('"+t+"')",a.http)},this.byguid=function(t){return new e(a.servicepoint,"(guid'"+t+"')",a.http)},this.byid=function(t){return new e(a.servicepoint,"("+t+")",a.http)},this.select=function(t){return""==a.queryparams?a.queryparams="?"+a._utils.getqueryparamstring(t,"$select="):a.queryparams=a.queryparams+"&"+a._utils.getqueryparamstring(t,"$select="),a},this.expand=function(t){return""==a.queryparams?a.queryparams="?"+a._utils.getqueryparamstring(t,"$expand="):a.queryparams=a.queryparams+"&"+a._utils.getqueryparamstring(t,"$expand="),a},this.filter=function(t){return"undefined"!=typeof t&&""!=t&&(""==a.queryparams?a.queryparams="?$filter="+t:a.queryparams=a.queryparams+"&$filter="+t),a},this.orderby=function(t){return"undefined"!=typeof t&&""!=t&&(""==a.queryparams?a.queryparams="?$orderby="+t:a.queryparams=a.queryparams+"&$orderby="+t),a},this.top=function(t){return"undefined"!=typeof t&&""!=t&&(""==a.queryparams?a.queryparams="?$top="+t:a.queryparams=a.queryparams+"&$top="+t),a},this.skip=function(t){return a},this.get=function(t){return a.http.get(a.queryurl+a.queryparams,a.queryheaders)},this.add=function(t){},this.update=function(t){},this.delete=function(t){},this.getquery=function(){return a.queryurl+a.queryparams},this.baseurl=n,this.endpoint=r,this.servicepoint=this.baseurl+this.endpoint,this.queryurl=this.servicepoint,this.http=i,this.baseweburl=this._utils.getweburlfromapiurl(n)}return e}();e.SPRESTEntity=n}(e=t.interfaces||(t.interfaces={}))}(ngsp||(ngsp={}));var ngsp;!function(t){var e;!function(t){var e=function(){function t(){this.getqueryparamstring=function(t,e){if("undefined"==typeof t)return"";if(0==t.length)return"";var n="";"undefined"!=typeof e&&(n=e);for(var r=0;r<t.length;r++)n+=t[r]+",";return n=n.slice(0,-1)}}return t.prototype.getweburlfromapiurl=function(t){return"undefined"==typeof t||""==t?"":t.split("/_api")[0]},t}();t.utils=e}(e=t.utilities||(t.utilities={}))}(ngsp||(ngsp={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},ngsp;!function(t){var e;!function(e){var n=function(t){function e(e,n){var i=this;t.call(this,e,"/_api/web",n),this.lists=function(){return new r(i.servicepoint,i.http)},this.folders=function(){return new u(i.servicepoint,i.http)}}return __extends(e,t),e}(t.interfaces.SPRESTEntity);e.web=n;var r=function(t){function e(e,n){var r=this;t.call(this,e,"/lists",n),this.bytitle=function(t){return new i(r.servicepoint,t,r.http)}}return __extends(e,t),e}(t.interfaces.SPRESTEntity);e.lists=r;var i=function(t){function e(e,n,r){var i=this;t.call(this,e,"/getbytitle('"+n+"')",r),this.items=function(){return new a(i.servicepoint,i.http,i)},this.fields=function(){return new s(i.servicepoint,i.http)}}return __extends(e,t),e}(t.interfaces.SPRESTEntity);e.list=i;var a=function(t){function e(e,n,r){var i=this;t.call(this,e,"/items",n),this.parentlist=r,this.initmetadata=function(){return i.parentlist.select(["ListItemEntityTypeFullName"]).get({}).then(function(t){return i.parentlistmetatdata=t.data.d,console.log("init "+i.parentlistmetatdata.ListItemEntityTypeFullName),1})},this.add=function(t){var e=$.Deferred();return i.parentlistmetatdata?e.resolve(1):e=i.initmetadata(),e.then(function(e){console.log("adding "+i.parentlistmetatdata.ListItemEntityTypeFullName);var n={__metadata:{type:i.parentlistmetatdata.ListItemEntityTypeFullName}},r=t.item;for(var a in r)r.hasOwnProperty(a)&&(n[a]=r[a]);var s={};return s.headers={},s.headers.accept="application/json;odata=verbose",s.headers["content-type"]="application/json;odata=verbose",i.contextobject.get().then(function(t){return s.headers["X-RequestDigest"]=t.data.d.GetContextWebInformation.FormDigestValue,i.http.post(i.servicepoint,n,s)})})},this.update=function(t){var e=$.Deferred();return i.parentlistmetatdata?e.resolve(1):e=i.initmetadata(),e.then(function(e){var n={__metadata:{type:i.parentlistmetatdata.ListItemEntityTypeFullName}},r=t.item;for(var a in r)r.hasOwnProperty(a)&&(n[a]=r[a]);var s={};return s.headers={},s.headers["IF-MATCH"]=t.etag,s.headers["X-HTTP-Method"]="MERGE",s.headers.accept="application/json;odata=verbose",s.headers["content-type"]="application/json;odata=verbose",i.contextobject.get().then(function(e){return s.headers["X-RequestDigest"]=e.data.d.GetContextWebInformation.FormDigestValue,i.http.post(i.servicepoint+"("+t.Id+")",n,s)})})},this.delete=function(t){var e={};return e.headers={},e.headers["IF-MATCH"]="*",e.headers["X-HTTP-Method"]="DELETE",i.contextobject.get().then(function(n){return e.headers["X-RequestDigest"]=n.data.d.GetContextWebInformation.FormDigestValue,i.http.post(i.servicepoint+"("+t.Id+")",null,e)})},this.getall=function(t){var e=[],n=i.queryurl+i.queryparams;return i.rungetQuery(n,e)},this.rungetQuery=function(t,e){var n=i;return n.http.get(t,n.queryheaders).then(function(t){return t.data.d.hasOwnProperty("__next")?(e=e.concat(t.data.d.results),n.rungetQuery(t.data.d.__next,e)):e.concat(t.data.d.results)})},this.contextobject=new h(this.baseweburl,this.http)}return __extends(e,t),e}(t.interfaces.SPRESTEntity);e.listitems=a;var s=function(t){function e(e,n){t.call(this,e,"/fields",n)}return __extends(e,t),e}(t.interfaces.SPRESTEntity);e.listfields=s;var u=function(t){function e(e,n){var r=this;t.call(this,e,"/folders",n),this.byrelativeurl=function(t){return new o(r.baseweburl+"/_api/web",t,r.http)}}return __extends(e,t),e}(t.interfaces.SPRESTEntity);e.folders=u;var o=function(t){function e(e,n,r){var i=this;t.call(this,e,"/GetFolderByServerRelativeUrl('"+n+"')",r),this.files=function(){return new c(i.servicepoint,i.http)}}return __extends(e,t),e}(t.interfaces.SPRESTEntity);e.folder=o;var c=function(t){function e(e,n){var r=this;t.call(this,e,"/files",n),this.byrelativeurl=function(t){return new p(r.baseweburl+"/_api/web",t,r.http)},this.add=function(t){var e=t.FileName,n=t.overwrite?"true":"false",i=r.servicepoint+"/add(overwrite="+n+", url='"+e+"')",a={};a.processData=!1,a.transformRequest=angular.identity,a.headers={},a.headers.accept="application/json;odata=verbose";var s=i,u=t.contents,o=r.http;return r.contextobject.get().then(function(t){return a.headers["X-RequestDigest"]=t.data.d.GetContextWebInformation.FormDigestValue,o.post(s,u,a)})},this.contextobject=new h(this.baseweburl,this.http)}return __extends(e,t),e}(t.interfaces.SPRESTEntity);e.files=c;var p=function(t){function e(e,n,r){var i=this;t.call(this,e,"/GetFileByServerRelativeUrl('"+n+"')",r),this.delete=function(t){var e=i.servicepoint,n={};n.transformRequest=angular.identity,n.headers={},n.headers.accept="application/json;odata=verbose",n.headers["X-HTTP-Method"]="DELETE",n.headers["IF-MATCH"]=t.etag;var r=e,a=i.http;return i.contextobject.get().then(function(t){return n.headers["X-RequestDigest"]=t.data.d.GetContextWebInformation.FormDigestValue,a.post(r,null,n)})},this.contextobject=new h(this.baseweburl,this.http)}return __extends(e,t),e}(t.interfaces.SPRESTEntity);e.file=p;var h=function(t){function e(e,n){var r=this;t.call(this,e,"/_api/contextinfo",n),this.get=function(t){return r.http.post(r.servicepoint,null,r.queryheaders)}}return __extends(e,t),e}(t.interfaces.SPRESTEntity);e.contextinfo=h}(e=t.entities||(t.entities={}))}(ngsp||(ngsp={}));var ngsp;!function(t){var e;!function(e){var n;!function(e){var n=function(){function e(e){var n=this;this.http=e,this.web=function(e){return new t.entities.web(e,n.http)}}return e.$inject=["$http"],e}();e.SP=n,angular.module("ngsp").service("sp",n)}(n=e.sp||(e.sp={}))}(e=t.services||(t.services={}))}(ngsp||(ngsp={}));